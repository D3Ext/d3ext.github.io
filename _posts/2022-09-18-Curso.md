---
layout: post
title: Curso de Hacking Wifi
pin: true
---

Hola a todos soy ***D3Ext***, en el dia de hoy traigo un curso totalmente gratuito de *hacking wifi* hecho por mi mismo. Las cosas se explican desde cero para poder auditar todo tipo de redes wifi. Si tienés alguna duda puedes contactarme por Discord, mi usuario es **d3ext**.

**¡No me hago cargo de cualquier mal uso que se le pueda dar a estos conocimientos!**

## Índice

1. [Requisitos](#requisitos)

      1.1. [¿Cómo elegir una buena antena?](#cómo-elegir-una-buena-antena)

2. [Introducción](#introducción)
3. [Configuración](#configuración)

    3.1. [Activar modo monitor](#activar-modo-monitor)

    3.2. [Desactivar modo monitor](#desactivar-modo-monitor)

    3.3. [Conceptos necesarios](#conceptos-necesarios)

4. [Cambiar direccion MAC](#cambiar-direccion-mac)
5. [Teoria Wifi](#teoria-wifi)
6. [Protocolos Wifi](#protocolos-wifi)

    6.1. [WEP](#wep)

    6.2. [WPA](#wpa)

    6.3. [WPA2](#wpa2)

    6.4. [WPA3](#wpa3)

7. [Capturar información Wifi](#capturar-información-wifi)

    7.1. [Método alternativo](#método-alternativo)

8. [Crackear Handshakes](#crackear-handshakes)
9. [Ataque de deautenticación](#ataque-de-deautenticación)
10. [Ataque de autenticación](#ataque-de-autenticación)
11. [Ataque Beacon Flood](#ataque-beacon-flood)
12. [Ataque PMKID](#ataque-pmkid)
13. [Ataque Pixie Dust](#ataque-pixie-dust)
14. [Ataque de fuerza bruta de PIN](#ataque-de-fuerza-bruta-de-pin)
15. [Ataque Null PIN](#ataque-null-pin)
16. [Ataque TKIP (Michael Shutdown Exploitation)](#)
17. [Ataque Evil Twin](#ataque-evil-twin)
18. [Uso de la herramienta WEF](#uso-de-la-herramienta-wef)
19. [Cómo detectar un ataque de deautenticación](#cómo-detectar-un-ataque-de-deautenticación)
20. [Descubrir redes ocultas](#descubrir-redes-ocultas)
21. [Extra](#extra)

    20.1. [Wardriving](#wardriving)

    20.2. [Crear gráficos de escaneos wifi](#crear-gráficos-de-escaneos-wifi)

    20.3. [Crear Rainbow Tables](#crear-rainbow-tables)

    20.4. [Hardware](#hardware)

    20.5. [Herramientas automatizadas](#herramientas-automatizadas)

    20.6. [Otros ataques secundarios](#otros-ataques-secundarios)

    20.7. [Errores comunes](#errores-comunes)

21. [Cheat sheet de comandos](#cheat-sheet-de-comandos)
22. [Conclusión](#conclusión)

---------------------------------------------
## Requisitos

Para poder llevar a cabo las tareas y diferentes ataques del curso es necesario contar con una antena de red que soporte el modo **monitor**. Ahora te estarás preguntando: **"¿Por qué hace falta una antena?"** y la respuesta es que para **inyectar los paquetes wifi** en el aire a nuestro antojo no nos sirve cualquier antena de red que ya venga por defecto en un PC o un portátil común.

También hace falta tener un sistema operativo desde donde poder realizar los ataques, aunque esto no lo voy a cubrir en el curso ya que hay muchos tutoriales en internet para poder instalar **Kali Linux**, **Parrot OS** entre otros sistemas como **Wifislax** (una distribucion orientada 100% al hacking wifi). Aun asi, en base a mi experiencia, te recomiendo **Parrot** ya que en **Kali Linux** suele hacer falta instalar **drivers** para poder usar la antena pero al contrario, en **Parrot** no suelen hacer falta. Cuando enchufé mi antena la primera vez ya funcionaba directamente, no tuve que hacer nada.

### ¿Cómo elegir una buena antena?

En mi caso mi antena es el modelo ***Alfa AWUS036ACM*** y puedo decir que merece la pena por su precio (alrededor de 46€ en tienda oficial europea) y funciona muy bien tanto para 2.4 GHz como para 5 GHz.

Para elegir la antena que más se adapte a tus necesidades vas a tener que tener diferentes cosas en cuenta:
- **Chipset** (lo lleva la antena y hace que pueda soportar modo monitor, por eso es lo más importante)
- **Marca de antena** (la más famosa y la mejor es [Alfa](https://alfa-network.eu), aunque también existen otras como [Panda](https://www.pandawireless.com/) o [TP-Link](https://www.tp-link.com/))
- **Potencia** (algunas modernas soportan 2,4 GHz y 5 GHz pero las antiguas solo 2,4 GHz. Además del alcance de la onda)
- **Precio** (la más barata por menos de 20€ y la más cara más de 60€, en tiendas oficiales)

Igualmente os dejo una lista de las que yo recomiendo:
- *Alfa AWUS036ACM*
- *Alfa AWUS1900*
- *Alfa AWUS036AC*
- *Alfa AWUS036ACH v.2*

Más info [aquí](https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Cards%20and%20Chipsets) en la Wiki oficial de Airgeddon

## Introducción

Si ya tienes la antena lista enciende tu **Kali** o **Parrot** y preparate porque hoy vas a aprender a realizar todo tipo de ataques y diferentes técnicas para auditar todas las redes wifi. También tengo que decir que se pueden hacer los ataques de forma automatizada sin tener absolutamente nada de conocimientos pero no sirve de nada porque no sabes ni aprendes nada de lo que estás haciendo, por eso solo recomiendo las herramientas automáticas una vez que ya controles el tema y sepas que hace cada ataque para evitar posibles daños. Aunque primero voy a explicar cómo se configura la antena para poder usarse y los diferentes comandos y funciones que hay para entender todo mejor.

Al principio puede parecer que todo es muy complejo y que son muchos comandos pero no te preocupes porque al final del curso te he dejado una **"Cheat Sheet"** para que puedas revisar que hace cada herramienta y sus usos comunes. También tengo que decir que si en algún momento no me he explicado bien (espero que no sea así), puedes buscar rápidamente en internet.

Algo que quizás os sorprenda es que desde fuera de una wifi se puede ver conexiones y demás información de la red, como por ejemplo cuántos clientes hay conectados en ese momento. Por eso todos los procedimientos que hoy veremos se realizan de la forma que explicaré para conseguir auditar redes.

## Configuración

Vamos a ver si la antena es reconocida y la interfaz se crea en el sistema correctamente, para eso ejecutamos lo siguiente:

```sh
ip link show
```

Si todo funciona bien debería aparecer algo como esto:

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/main/images/wifi/wifi-course1.png" alt="pic">

El nombre de tu interfaz puede ser diferente (wlan1, wlan2...). Como vemos está todo bien.

Si ejecutamos:

```sh
iw dev
```

Vemos las diferentes interfaces wireless:

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/main/images/wifi/wifi-course2.png" alt="pic">

Podemos ver las interfaces, en este caso **wlan0**. Aparece el modo de la interfaz (puede ser Managed, Monitor, Promisc...), el punto de acceso al que está asociada la interfaz (en este caso no está vinculado a ninguna) y demás info sobre la antena.

### Activar modo monitor

Para empezar a usar la antena para auditar redes debemos iniciarla en el modo monitor como ya dije antes, este proceso se puede hacer de dos formas, la más recomendable es con **airmon-ng** y la otra con **iw**. También os aconsejo que si teneis algún error durante el curso al ejecutar algún comando vayáis a la sección de [Errores Comunes](#errores-comunes) donde dejaré algunos problemas resueltos en cuanto a wifi respecta.

Para iniciarla correctamente ejecutamos:

```sh
airmon-ng start wlan0
```

En tu caso cambia el nombre de **wlan0** si es necesario

Y si ahora volvemos a listar las interfaces virtuales vemos que el nombre cambia añadiendo **"mon"** y el modo también ha cambiado, por lo que ya estaríamos listos.

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/main/images/wifi/wifi-course3.png" alt="pic">

La segunda manera de hacer esto seria con **iw** de la siguiente forma:

```sh
ip link set wlan0 down
iw wlan0 set type monitor
ip link set wlan0 up
```

Con esta forma el nombre de la interfaz no añade el **mon** al final pero no deberia de haber problema, asi que solo tendrias que cambiar el nombre de la interfaz al tuyo en los diferentes comandos en case de no llamarse igual

### Desactivar modo monitor

Para devolver la interfaz al modo managed (normal) es muy sencillo solo hay que ejecutar un comando (version actual):

```sh
airmon-ng stop wlan0mon
ip link set wlan0 up
```

El comando de `airmon-ng` se encarga de quitar el modo monitor y el comando de `ip` se encarga de poner activa la interfaz una vez reconfigurada.

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/main/images/wifi/wifi-course4.png" alt="pic">

Y al listar las interfaces virtuales vemos que todo está como al principio

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/main/images/wifi/wifi-course2.png" alt="pic">

Para hacer esta tarea de la otra forma, (con `iw`) ejecuta lo siguiente:

```sh
ip link set wlan0 down
iw wlan0 set type managed
ip link set wlan0 up
```

Y tu interfaz deberia volver a ponerse en modo managed sin problemas

### Conceptos necesarios

- Debéis saber que durante los ataques se pierde la conexión wifi, ya que en el sistema existen dos servicios que se encargan de mantener la conexión wifi, estos servicios son **wpa_supplicant** y **NetworkManager**. Pero al tratar de inyectar los paquetes en el aire para realizar cualquier ataque, algunos de esos paquetes se pierden y no llegan al destino, por eso se recomienda *"matar"* esos dos procesos, y para ello **airmon-ng** tiene una opción. En resumen, se pueden hacer los ataques matando los procesos o no, aunque es recomendable hacerlo ya que si no se matan pueden interferir en el ataque, lo malo es que te quedas sin conexión

> Para matar los procesos conflictivos
```sh
airmon-ng check kill
```

Eso debería servir para hacerlo.

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/main/images/wifi/wifi-course5.png" alt="pic">

Cuando dejes de atacar y quieras volver a tener wifi debes ejecutar estos dos comandos para restablecer los dos servicios:

> Para reiniciar los servicios de la conexión
```sh
systemctl restart NetworkManager
systemctl restart wpa_supplicant
```

- Otra cosa muy importante en la que se basa el hacking wifi es en los **handshakes**.

**¿Qué es un handshake?**, pues para entenderlo de forma fácil es una contraseña encriptada que se transmite en paquetes wifi cuando un cliente se conecta a un punto de acceso (por ejemplo al conectarte con el móvil a tu red wifi personal). Y lo que hacen muchos ataques es intentar expulsar a un dispositivo de la red wifi para que al conectarse automáticamente, el atacante pueda obtener el **handshake** para poder crackearlo después con herramientas como **hashcat** y así poder tener la contraseña de la red wifi.

> Metodología de hacking wifi
<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/main/images/wifi/wifi-hacking-process.png" alt="pic">

Hasta aquí la parte de configuración y conceptos básicos. También podeis ver más comandos y contenido [aqui](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-wifi#wifi-basic-commands) y [aqui](https://linuxhint.com/monitor_mode_kali_linux/)

## Cambiar direccion MAC

En esta sección veremos que es la dirección MAC, para qué sirve, por qué cambiarla y que tiene que ver con hacking wifi

Bueno, pues la verdad que son preguntas sencillas.
La dirección MAC es un identificador único que tiene cada dispositivo físico como puede serlo tu móvil o tu televisión, y como ya he dicho permite identificar dispositivos por lo que al auditar redes wifi pueden llegar a ver tu dirección MAC (identificador que envía los paquetes) y por eso es buena práctica cambiarla con la herramienta `macchanger` (instalada por defecto en Kali y Parrot)

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/main/images/wifi/mac.jpg" alt="pic">

Para cambiarla por una dirección totalmente aleatoria, podemos ejecutar estos comandos una vez que la interfaz está en modo monitor:

> Apaga la interfaz, cambia la MAC de forma aleatoria y la enciende de nuevo
```sh
ip link set wlan0mon down
macchanger -r wlan0mon
ip link set wlan0mon up
```

Y como podemos ver aparece la MAC antigua y la nueva

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/main/images/wifi/wifi-course6.png" alt="pic">

Si quereis consultar más recursos acerca de cambiar la MAC, podéis aprender [aqui](https://itsfoss.com/change-mac-address-linux/) y [aqui](https://www.makeuseof.com/how-to-change-mac-address-on-linux/)

## Teoria Wifi

Para entender mejor todos los ataques, también debemos conocer como funciona la tecnologia **Wi-Fi** a nivel *"cientifico"*

El estándar **802.11** es una familia de normas inalámbricas creada por el **Institute of Electrical and Electronics Engineers (IEEE)**. **802.11n** es la forma más apropiada de llamar a la tecnología **Wi-Fi**, lanzada en **2009**. Mejoró con respecto a versiones anteriores de Wi-Fi con múltiples radios, técnicas avanzadas de transmisión y recepción, y la opción de usar el espectro de 5 GHz. Todo implica una velocidad de datos de hasta **600 Mbps**

La familia **802.11** consta de una serie de técnicas de *modulación semidúplex* (half duplex) por medio del aire que utilizan el mismo protocolo básico. Al estándar **802.11-1997** le siguió el **802.11b**, que fue el primero aceptado ampliamente. Posteriormente surgirían versiones mejoradas: 802.11a, 802.11g, 802.11n y 802.11ac.

Por otro lado la versión **802.11a** utiliza la banda **U-NII** de 5 GHz que, para gran parte del mundo, ofrece al menos **23 canales** que no se superponen en lugar de la banda de frecuencia ISM de 2,4 GHz que ofrece solo tres canales que no se superponen (El canal **1**, **6** y **11**). **802.11n** puede utilizar la banda de 2,4 GHz o la de 5 GHz mientras que **802.11ac** utiliza solo la banda de 5 GHz. El segmento del espectro de radiofrecuencia utilizado por la **802.11** varía de un país a otro. Las frecuencias utilizadas por los canales uno a seis de **802.11b** y **802.11g** caen dentro de la banda de radioaficionados de 2,4 GHz.

- También te preguntaras como es que los dispositivos detectan las wifis cercanas, deja que te explique.

Como ya sabras cuando tu conectas a una red wifi y luego vuelves al mismo sitio, tu dispositivo se conecta automaticamente, eso ocurre porque los dispositivos recuerdan los puntos de acceso a los que han estado conectados y tu dispositivo siempre está emitiendo unos paquetes llamados **"Probe requests"** los cuales están buscando puntos de acceso. Si al enviar esos **"Probe requests"** tu dispositivo recibe la **"Probe response"** significa que el AP (punto de acceso) ha recibido el paquete y eso indica que el AP está cerca y activo, por lo que el dispositivo se asociaría de forma automatica en caso de haber estado conectado anteriormente.
